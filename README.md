# Проект 1
Опишите здесь поэтапно ход решения задачи. Вы можете ориентироваться на тот план выполнения проекта, который мы предлагаем в инструкции на платформе.


# 1. Постройте витрину для RFM-анализа

1.1. Выясните требования к целевой витрине
1.2. Изучите структуру исходных данных
Требования к целевой витрине, структуру исходных данных описываю в файле requirements.md.

1.3. Проанализируйте качество данных
В документе data_quality.md рассматриваю каждую из 6 таблиц схемы production (количество строк, количество уникальных идентификаторов, сопоставляю идентификаторы, которые являются внешними ключами, с таблицами, где они же являются первичными ключами).
Для всех таблиц схемы production описываю все поля с точки зрения наличия ограничений.

1.4. Подготовьте витрину данных
В документе views.sql код для создания представлений для основных 5 таблиц схемы production.

В документе datamart_ddl.sql код для создания таблицы, куда в дальнейшем будут сложены все данные для витрины.

В документах tmp_rfm_recency.sql, tmp_rfm_frequency.sql, tmp_rfm_monetary_value.sql — SQL-запросы для создания и заполнения одноименных таблиц. При расчете 1-5 групп для каждого из признаков рассчитываю номер строки (row_number) для каждого пользователя в порядке возрастания ключевого атрибута, затем делю на количество пользователей, умножаю на 5 (количество групп, на которые и нужно сегментировать пользователей), и округлив до наибольшего целого - получаю номер группы.

В документе datamart_query.sql - код для заполнения витрины analysis.dm_rfm_segments на основе analysis.tmp_rfm_recency, analysis.tmp_rfm_frequency и analysis.tmp_rfm_monetary_value и комментарий с 10 пользователями и показателями, которые были для них рассчитаны.

2. Доработка представлений
ВВ документе orders_view.sql - код для создания нового представления analysis.orders, но уже с расчетным полем status (на основе таблицы orderslogs). Для каждого заказа взят максимальный статус, учитывая окно - номер заказа и с сортировкой по максимальной дате (то есть по сути - это статус для одного заказа за последнюю дату+время).
